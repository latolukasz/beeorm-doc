# Lazy Flush

In many scenarios, adding, editing, and deleting entities can be done asynchronously using BeeORM's `engine.FlushLazy` method. This method adds the necessary SQL queries to a special Redis stream called `orm-lazy-channel`. A [background consumer](/guide/background_consumer.html) script can then read these queries from the stream and execute them.

Here's an example of how to use `FlushLazy`:

<code-group>
<code-block title="code">
```go{3,8,12}
// adding new entity
user := &UserEntity{FirstName: "Tom", LastName: "Bee", Email: "bee@beeorm.io"}
engine.FlushLazy(user) 

// updating entity
engine.LoadByID(1, user)
user.Name = "John"
engine.FlushLazy(user)

// deleting entity
engine.LoadByID(2, user)
engine.DeleteLazy(user)
```
</code-block>

<code-block title="queries">
```sql
REDIS XAdd orm-lazy-channel event
REDIS XAdd orm-lazy-channel event
REDIS XAdd orm-lazy-channel event
```
</code-block>
</code-group>

::: tip
If the length of the `orm-lazy-channel` stream is high or growing, it means that you forgot to run the [background consumer](/guide/background_consumer.html) in your application.
:::

If you need to flush more than one entity, you can use the [Flusher](/guide/crud.html#flusher) and its` FlushLazy` method:

<code-group>
<code-block title="code">
```go{13}
flusher := engine.NewFlusher()

user := &UserEntity{FirstName: "Tom", LastName: "Bee", Email: "bee@beeorm.io"}
flusher.Track(user) 
var userToUpdate *UserEntity
engine.LoadByID(1, userToUpdate)
userToUpdate.Name = "John"
flusher.Track(userToUpdate)
var userToDelete *UserEntity
engine.LoadByID(2, userToDelete)
flusher.Delete(userToDelete)

flusher.FlushLazy()
```
</code-block>

<code-block title="queries">
```sql
REDIS XAdd orm-lazy-channel event event event
```
</code-block>
</code-group>

## Defining lazy queries pool name

You can define another redis pool for flush lazy stream:

<code-group>
<code-block title="code">
```go{3}
registry := beeorm.NewRegistry()
registry.RegisterRedis("192.123.11.12:6379", "", 0, "lazy")
registry.RegisterRedisStream("orm-lazy-channel", "lazy", []string{"orm-async-consumer"})
```
</code-block>

<code-block title="yaml">
```yml{4,5}
lazy:
    redis: 192.123.11.12:6379
    streams:
        orm-lazy-channel:
          - orm-async-consumer
```
</code-block>
</code-group>

## Defining lazy queries workers
You can define how many SQL queries generated by `engine.FlushLazy()` should be executed at the same time in
parallel. By default Background consumer runs 11 queries in parallel. You can change it using
`SetLazyFlushWorkers` method:

```go{2}
consumer := beeorm.NewBackgroundConsumer(engine)
consumer.SetLazyFlushWorkers(20)
```
